

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Moving data between Java and R code &mdash; Renjin 0.7.0-RC7 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Renjin 0.7.0-RC7 documentation" href="index.html"/>
        <link rel="next" title="3. Importing Java classes into R code" href="importing-java-classes-in-r-code.html"/>
        <link rel="prev" title="1. Introduction" href="introduction.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Renjin</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#about-renjin">1.1. About Renjin</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#prerequisites">1.2. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#setting-up-a-java-project-for-renjin">1.3. Setting up a Java project for Renjin</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#evaluating-r-language-code">1.4. Evaluating R language code</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#using-cran-packages-in-renjin">1.5. Using CRAN packages in Renjin</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">2. Moving data between Java and R code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-java-developer-s-guide-to-r-objects">2.1. A Java developer&#8217;s guide to R objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-renjin-s-type-system">2.2. Overview of Renjin&#8217;s type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pulling-data-from-r-into-java">2.3. Pulling data from R into Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-errors-generated-by-the-r-code">2.4. Handling errors generated by the R code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pushing-data-from-java-to-r">2.5. Pushing data from Java to R</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="importing-java-classes-in-r-code.html">3. Importing Java classes into R code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="importing-java-classes-in-r-code.html#bean-classes">3.1. Bean classes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing-renjin-extensions.html">4. Writing Renjin Extensions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="writing-renjin-extensions.html#package-directory-layout">4.1. Package directory layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing-renjin-extensions.html#renjin-maven-plugin">4.2. Renjin Maven plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing-renjin-extensions.html#using-the-hamcrest-package-to-write-unit-tests">4.3. Using the <em>hamcrest</em> package to write unit tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="renjin-java-api-specification.html">5. Renjin Java API specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="renjin-java-api-specification.html#org-renjin-sexp">5.1. org.renjin.sexp</a></li>
<li class="toctree-l2"><a class="reference internal" href="renjin-java-api-specification.html#package-org.renjin.primitives.matrix">5.2. org.renjin.primitives.matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="renjin-java-api-specification.html#exceptions">5.3. Exceptions</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Renjin</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>2. Moving data between Java and R code</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/moving-data-between-java-and-r-code.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="moving-data-between-java-and-r-code">
<h1>2. Moving data between Java and R code<a class="headerlink" href="#moving-data-between-java-and-r-code" title="Permalink to this headline">¶</a></h1>
<p>If you read the <a class="reference internal" href="introduction.html"><em>Introduction</em></a> to this guide you already know how to
execute R code from a Java application. In this chapter we will take things a
little further and explain how you can move data between Java and R code.</p>
<p>Renjin provides a mapping from R language types to Java objects. To use this
mapping effectively you should have at least a basic understanding of R&#8217;s object
types.  The next section provides a short introduction which is essentially a
condensed version of the relevant material in the <a class="reference external" href="http://cran.r-project.org/doc/manuals/r-release/R-lang.html">R Language Definition
manual</a>. If you are already familiar with R&#8217;s object types you can skip this
section and head straight to the section <a class="reference internal" href="#sec-pulling-data-from-r-into-java"><em>Pulling data from R into Java</em></a> or
<a class="reference internal" href="#sec-pushing-data-from-java-to-r"><em>Pushing data from Java to R</em></a>.</p>
<div class="section" id="a-java-developer-s-guide-to-r-objects">
<span id="sec-java-developer-guide-to-r-objects"></span><h2>2.1. A Java developer&#8217;s guide to R objects<a class="headerlink" href="#a-java-developer-s-guide-to-r-objects" title="Permalink to this headline">¶</a></h2>
<p>R has a number of objects types that are referred to as <em>basic types</em>. Of these,
we only discuss those that are most frequently encountered by users of R:
vectors, lists, functions, and the <tt class="docutils literal"><span class="pre">NULL</span></tt> object. We also discuss the two common
compound objects in R, namely data frames and factors.</p>
<div class="section" id="attributes">
<span id="sec-attributes"></span><h3>2.1.1. Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p id="index-0">Before we discuss these objects, it is important to know that all objects
except the <tt class="docutils literal"><span class="pre">NULL</span></tt> object can have one or more attributes. Common attributes
are the <tt class="docutils literal"><span class="pre">names</span></tt> attribute which contains the element names, the <tt class="docutils literal"><span class="pre">class</span></tt>
attribute which stores the name of the class of the object, and the <tt class="docutils literal"><span class="pre">dim</span></tt>
attribute and (optionally) its <tt class="docutils literal"><span class="pre">dimnames</span></tt> companion to store the size of each
dimension (and the name of each dimension) of the object. For each object, the
<tt class="docutils literal"><span class="pre">attributes()</span></tt> command will return a list with the attributes and their
values. The value of a specific attribute can be obtained using the <tt class="docutils literal"><span class="pre">attr()</span></tt>
function. For example, <tt class="docutils literal"><span class="pre">attr(x,</span> <span class="pre">&quot;class&quot;)</span></tt> will return the name of the class
of the object (or <tt class="docutils literal"><span class="pre">NULL</span></tt> if the attribute is not defined).</p>
</div>
<div class="section" id="vectors">
<h3>2.1.2. Vectors<a class="headerlink" href="#vectors" title="Permalink to this headline">¶</a></h3>
<p id="index-1">There are six basic vector types which are referred to as the <em>atomic vector
types</em>. These are:</p>
<dl class="docutils">
<dt>logical:</dt>
<dd>a boolean value (for example: <tt class="docutils literal"><span class="pre">TRUE</span></tt>)</dd>
<dt>integer:</dt>
<dd>an integer value (for example: <tt class="docutils literal"><span class="pre">1</span></tt>)</dd>
<dt>double:</dt>
<dd>a real number (for example: <tt class="docutils literal"><span class="pre">1.5</span></tt>)</dd>
<dt>character:</dt>
<dd>a character string (for example: <tt class="docutils literal"><span class="pre">&quot;foobar&quot;</span></tt>)</dd>
<dt>complex:</dt>
<dd>a complex number (for example: <tt class="docutils literal"><span class="pre">1+2i</span></tt>)</dd>
<dt>raw:</dt>
<dd>uninterpreted bytes (forget about this one)</dd>
</dl>
<p>These vectors have a length and can be indexed using <tt class="docutils literal"><span class="pre">[</span></tt> as the following sample
R session demonstrates:</p>
<div class="highlight-rout"><div class="highlight"><pre><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>length<span class="p">(</span>x<span class="p">)</span>
<span class="go">[1] 1</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>y<span class="p">[</span><span class="m">2</span><span class="p">]</span>
<span class="go">[1] 3</span>
</pre></div>
</div>
<p id="index-2">As you can see, even single numbers are vectors with length equal to one.
Vectors in R can have missing values that are represented as <tt class="docutils literal"><span class="pre">NA</span></tt>. Because all
elements in a vector must be of the same type (i.e. logical, double, int, etc.)
there are multiple types of <tt class="docutils literal"><span class="pre">NA</span></tt>. However, the casual R user will generally
not be concerned with the different types for <tt class="docutils literal"><span class="pre">NA</span></tt>.</p>
<div class="highlight-rout"><div class="highlight"><pre><span class="gp">&gt; </span>x <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>x
<span class="go">[1]  1 NA  3</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> as.character<span class="p">(</span><span class="kc">NA</span><span class="p">)</span>
<span class="gp">&gt; </span>y
<span class="go">[1] NA</span>
<span class="gp">&gt; </span>typeof<span class="p">(</span><span class="kc">NA</span><span class="p">)</span> <span class="c1"># default type of NA is logical</span>
<span class="go">[1] &quot;logical&quot;</span>
<span class="gp">&gt; </span>typeof<span class="p">(</span>y<span class="p">)</span> <span class="c1"># but we have coerced &#39;y&#39; to a character vector</span>
<span class="go">[1] &quot;character&quot;</span>
</pre></div>
</div>
<p>R&#8217;s <tt class="docutils literal"><span class="pre">typeof()</span></tt> function returns the internal type of each object. In the
example above, <tt class="docutils literal"><span class="pre">y</span></tt> is a character vector.</p>
</div>
<div class="section" id="factors">
<h3>2.1.3. Factors<a class="headerlink" href="#factors" title="Permalink to this headline">¶</a></h3>
<p id="index-3">Factors are one of R&#8217;s compound data types. Internally, they are represented by
integer vectors with a <tt class="docutils literal"><span class="pre">levels</span></tt> attribute. The following sample R session
creates such a factor from a character vector:</p>
<div class="highlight-rout"><div class="highlight"><pre><span class="gp">&gt; </span>x <span class="o">&lt;-</span> sample<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="s">&quot;C&quot;</span><span class="p">),</span> size <span class="o">=</span> <span class="m">10</span><span class="p">,</span> replace <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>x
<span class="go"> [1] &quot;C&quot; &quot;B&quot; &quot;B&quot; &quot;C&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;C&quot; &quot;B&quot;</span>
<span class="gp">&gt; </span>as.factor<span class="p">(</span>x<span class="p">)</span>
<span class="go"> [1] C B B C A A B B C B</span>
<span class="go">Levels: A B C</span>
</pre></div>
</div>
<p>Internally, the factor in this example is stored as an integer vector <tt class="docutils literal"><span class="pre">c(3,</span> <span class="pre">2,</span>
<span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">2)</span></tt> which are the indices of the letters in the character
vector <tt class="docutils literal"><span class="pre">c(A,</span> <span class="pre">B,</span> <span class="pre">C)</span></tt> stored in the <tt class="docutils literal"><span class="pre">levels</span></tt> attribute.</p>
</div>
<div class="section" id="lists">
<span id="sec-lists"></span><h3>2.1.4. Lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h3>
<p>Lists are R&#8217;s go-to structures for representing data structures. They can
contain multiple elements, each of which can be of a different type. Record-like
structures can be created by naming each element in the list. The <tt class="docutils literal"><span class="pre">lm()</span></tt>
function, for example, returns a list that contains many details about the
fitted linear model. The following R session shows the difference between a list
and a list with named elements:</p>
<div class="highlight-rout"><div class="highlight"><pre><span class="gp">&gt; </span>l <span class="o">&lt;-</span> list<span class="p">(</span><span class="s">&quot;Jane&quot;</span><span class="p">,</span> <span class="m">23</span><span class="p">,</span> c<span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">))</span>
<span class="gp">&gt; </span>l
<span class="go">[[1]]</span>
<span class="go">[1] &quot;Jane&quot;</span>

<span class="go">[[2]]</span>
<span class="go">[1] 23</span>

<span class="go">[[3]]</span>
<span class="go">[1] 6 7 9 8</span>

<span class="gp">&gt; </span>l <span class="o">&lt;-</span> list<span class="p">(</span>name <span class="o">=</span> <span class="s">&quot;Jane&quot;</span><span class="p">,</span> age <span class="o">=</span> <span class="m">23</span><span class="p">,</span> scores <span class="o">=</span> c<span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">))</span>
<span class="gp">&gt; </span>l
<span class="go">$name</span>
<span class="go">[1] &quot;Jane&quot;</span>

<span class="go">$age</span>
<span class="go">[1] 23</span>

<span class="go">$scores</span>
<span class="go">[1] 6 7 9 8</span>
</pre></div>
</div>
<p id="index-4">In R, lists are also known as <em>generic vectors</em>. They have a length that is
equal to the number of elements in the list.</p>
</div>
<div class="section" id="data-frames">
<h3>2.1.5. Data frames<a class="headerlink" href="#data-frames" title="Permalink to this headline">¶</a></h3>
<p>Data frames are one of R&#8217;s compound data types. They are lists of vectors,
factors and/or matrices, all having the same length. It is one of the most
important concepts in statistics and has equivalent implementations in <a class="reference external" href="http://www.sas.com">SAS</a> and
<a class="reference external" href="http://www.ibm.com/software/analytics/spss/">SPSS</a>.</p>
<p id="index-5">The following sample R session shows how a data frame is constructed, what its
attributes are and that it is indeed a list:</p>
<div class="highlight-rout"><div class="highlight"><pre><span class="gp">&gt; </span>df <span class="o">&lt;-</span> data.frame<span class="p">(</span>x <span class="o">=</span> seq<span class="p">(</span><span class="m">5</span><span class="p">),</span> y <span class="o">=</span> runif<span class="p">(</span><span class="m">5</span><span class="p">))</span>
<span class="gp">&gt; </span>df
<span class="go">  x         y</span>
<span class="go">1 1 0.8773874</span>
<span class="go">2 2 0.4977048</span>
<span class="go">3 3 0.6719721</span>
<span class="go">4 4 0.2135386</span>
<span class="go">5 5 0.3834681</span>
<span class="gp">&gt; </span>class<span class="p">(</span>df<span class="p">)</span>
<span class="go">[1] &quot;data.frame&quot;</span>
<span class="gp">&gt; </span>attributes<span class="p">(</span>df<span class="p">)</span>
<span class="go">$names</span>
<span class="go">[1] &quot;x&quot; &quot;y&quot;</span>

<span class="go">$row.names</span>
<span class="go">[1] 1 2 3 4 5</span>

<span class="go">$class</span>
<span class="go">[1] &quot;data.frame&quot;</span>

<span class="gp">&gt; </span>is.list<span class="p">(</span>df<span class="p">)</span>
<span class="go">[1] TRUE</span>
</pre></div>
</div>
</div>
<div class="section" id="matrices-and-arrays">
<span id="sec-matrices-and-arrays"></span><h3>2.1.6. Matrices and arrays<a class="headerlink" href="#matrices-and-arrays" title="Permalink to this headline">¶</a></h3>
<p id="index-6">Besides one-dimensional vectors, R also knows two other classes to represent
array-like data types: <tt class="docutils literal"><span class="pre">matrix</span></tt> and <tt class="docutils literal"><span class="pre">array</span></tt>. A matrix is simply an atomic
vector with a <tt class="docutils literal"><span class="pre">dim</span></tt> attribute that contains a numeric vector of length two:</p>
<div class="highlight-rout"><div class="highlight"><pre><span class="gp">&gt; </span>x <span class="o">&lt;-</span> seq<span class="p">(</span><span class="m">9</span><span class="p">)</span>
<span class="gp">&gt; </span>class<span class="p">(</span>x<span class="p">)</span>
<span class="go">[1] &quot;integer&quot;</span>
<span class="gp">&gt; </span>dim<span class="p">(</span>x<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>class<span class="p">(</span>x<span class="p">)</span>
<span class="go">[1] &quot;matrix&quot;</span>
<span class="gp">&gt; </span>x
<span class="go">     [,1] [,2] [,3]</span>
<span class="go">[1,]    1    4    7</span>
<span class="go">[2,]    2    5    8</span>
<span class="go">[3,]    3    6    9</span>
</pre></div>
</div>
<p>Likewise, an array is also a vector with a <tt class="docutils literal"><span class="pre">dim</span></tt> attribute that contains a
numeric vector of length greater than two:</p>
<div class="highlight-rout"><div class="highlight"><pre><span class="gp">&gt; </span>y <span class="o">&lt;-</span> seq<span class="p">(</span><span class="m">8</span><span class="p">)</span>
<span class="gp">&gt; </span>dim<span class="p">(</span>y<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>class<span class="p">(</span>y<span class="p">)</span>
<span class="go">[1] &quot;array&quot;</span>
</pre></div>
</div>
<p>The example with the matrix shows that the elements in an array are stored in
<a class="reference external" href="http://en.wikipedia.org/wiki/Row-major_order#Column-major_order">column-major order</a> which is important to know when we want to access R
arrays from a Java application.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In both examples for the <tt class="docutils literal"><span class="pre">matrix</span></tt> and <tt class="docutils literal"><span class="pre">array</span></tt> objects, the <tt class="docutils literal"><span class="pre">class()</span></tt>
function derives the class from the fact that the object is an atomic vector
with the <tt class="docutils literal"><span class="pre">dim</span></tt> attribute set. Unlike data frames, these objects do not
have a <tt class="docutils literal"><span class="pre">class</span></tt> attribute.</p>
</div>
</div>
</div>
<div class="section" id="overview-of-renjin-s-type-system">
<h2>2.2. Overview of Renjin&#8217;s type system<a class="headerlink" href="#overview-of-renjin-s-type-system" title="Permalink to this headline">¶</a></h2>
<p id="index-7">Renjin has corresponding classes for all of the R object types discussed in the
section <a class="reference internal" href="#sec-java-developer-guide-to-r-objects"><em>A Java developer&#8217;s guide to R objects</em></a>. Table
<a class="reference internal" href="#tab-renjin-type-classes"><em>Renjin&#8217;s Java classes for common R object types</em></a> summarizes these object types and their Java
classes. In R, the object type is returned by the <tt class="docutils literal"><span class="pre">typeof()</span></tt> function.</p>
<table border="1" class="docutils" id="tab-renjin-type-classes">
<caption>Renjin&#8217;s Java classes for common R object types</caption>
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">R object type</th>
<th class="head">Renjin class</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>logical</td>
<td>LogicalVector</td>
</tr>
<tr class="row-odd"><td>integer</td>
<td>IntVector</td>
</tr>
<tr class="row-even"><td>double</td>
<td>DoubleVector</td>
</tr>
<tr class="row-odd"><td>character</td>
<td>StringVector</td>
</tr>
<tr class="row-even"><td>complex</td>
<td>ComplexVector</td>
</tr>
<tr class="row-odd"><td>raw</td>
<td>RawVector</td>
</tr>
<tr class="row-even"><td>list</td>
<td>ListVector</td>
</tr>
<tr class="row-odd"><td>function</td>
<td>Function</td>
</tr>
<tr class="row-even"><td>environment</td>
<td>Environment</td>
</tr>
<tr class="row-odd"><td>NULL</td>
<td>Null</td>
</tr>
</tbody>
</table>
<p>There is a certain hierarchy in Renjin&#8217;s Java classes for the different object
types in R. Figure <a class="reference internal" href="#fig-renjin-type-system"><em>Hierarchy in Renjin&#8217;s type system</em></a> gives a full picture of all
classes that make up Renjin&#8217;s type system. These classes are contained in the
<em>org.renjin.sexp</em> Java package. The vector classes listed in table
<a class="reference internal" href="#tab-renjin-type-classes"><em>Renjin&#8217;s Java classes for common R object types</em></a> are in fact abstract classes that can have
different implementations. For example, the <tt class="docutils literal"><span class="pre">DoubleArrayVector</span></tt> (not shown in
the figure) is an implementation of the <tt class="docutils literal"><span class="pre">DoubleVector</span></tt> abstract class. The
<a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP" title="org.renjin.sexp.SEXP"><tt class="xref java java-ref docutils literal"><span class="pre">SEXP</span></tt></a>, <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.Vector" title="org.renjin.sexp.Vector"><tt class="xref java java-ref docutils literal"><span class="pre">Vector</span></tt></a>, and <tt class="docutils literal"><span class="pre">AtomicVector</span></tt> classes are all Java
interfaces.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Renjin does not have classes for all classes of objects that are know to
(base) R. This includes objects of class <tt class="docutils literal"><span class="pre">matrix</span></tt> and <tt class="docutils literal"><span class="pre">array</span></tt> which are
represented by one of the <tt class="docutils literal"><span class="pre">AtomicVector</span></tt> classes and R&#8217;s compound objects
<tt class="docutils literal"><span class="pre">factor</span></tt> and <tt class="docutils literal"><span class="pre">data.frame</span></tt> which are represented by an <tt class="docutils literal"><span class="pre">IntVector</span></tt> and
<a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.ListVector" title="org.renjin.sexp.ListVector"><tt class="xref java java-ref docutils literal"><span class="pre">ListVector</span></tt></a> respectively.</p>
</div>
<div class="figure" id="fig-renjin-type-system">
<img alt="_images/renjin-class-hierarchy.png" src="_images/renjin-class-hierarchy.png" />
<p class="caption">Hierarchy in Renjin&#8217;s type system</p>
</div>
</div>
<div class="section" id="pulling-data-from-r-into-java">
<span id="sec-pulling-data-from-r-into-java"></span><h2>2.3. Pulling data from R into Java<a class="headerlink" href="#pulling-data-from-r-into-java" title="Permalink to this headline">¶</a></h2>
<p>Now that you have a good understanding of both R&#8217;s object types and how these
types are mapped to Renjin&#8217;s Java classes, we can start by pulling data from R
code into our Java application. A typical scenario is one where an R script
performs a calculation and the result is pulled into the Java application for
further processing.</p>
<p>Using the Renjin Script Engine as introduced in the <a class="reference internal" href="introduction.html"><em>Introduction</em></a>, we can
store the result of a calculation from R into a Java object. By default, the
<tt class="docutils literal"><span class="pre">eval()</span></tt> method of <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/javax/script/ScriptEngine.html" title="javax.script.ScriptEngine"><tt class="xref java java-ref docutils literal"><span class="pre">javax.script.ScriptEngine</span></tt></a> returns an
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html" title="java.lang.Object"><tt class="xref java java-ref docutils literal"><span class="pre">Object</span></tt></a>, i.e. Java&#8217;s object superclass. We can
always cast this result to a <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP" title="org.renjin.sexp.SEXP"><tt class="xref java java-ref docutils literal"><span class="pre">SEXP</span></tt></a> object. The following Java
snippet shows how this is done and how the <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#getClass()" title="java.lang.Object.getClass()"><tt class="xref java java-ref docutils literal"><span class="pre">Object.getClass()</span></tt></a> and <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/Class.html#getName()" title="java.lang.Class.getName()"><tt class="xref java java-ref docutils literal"><span class="pre">Class.getName()</span></tt></a> methods can be used to determine the actual class
of the R result:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// evaluate Renjin code from String:</span>
<span class="n">SEXP</span> <span class="n">res</span> <span class="o">=</span> <span class="o">(</span><span class="n">SEXP</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;a &lt;- 2; b &lt;- 3; a*b&quot;</span><span class="o">);</span>

<span class="c1">// print the result to stdout:</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;The result of a*b is: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="o">);</span>
<span class="c1">// determine the Java class of the result:</span>
<span class="n">Class</span> <span class="n">objectType</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Java class of &#39;res&#39; is: &quot;</span> <span class="o">+</span> <span class="n">objectType</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="c1">// use the getTypeName() method of the SEXP object to get R&#39;s type name:</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;In R, typeof(res) would give &#39;&quot;</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="na">getTypeName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>This should write the following to the standard output:</p>
<div class="highlight-none"><div class="highlight"><pre>The result of a*b is: 6.0
Java class of &#39;res&#39; is: org.renjin.sexp.DoubleArrayVector
In R, typeof(res) would give &#39;double&#39;
</pre></div>
</div>
<p>As you can see the <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP.getTypeName()" title="org.renjin.sexp.SEXP.getTypeName()"><tt class="xref java java-ref docutils literal"><span class="pre">getTypeName</span></tt></a> method of the <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP" title="org.renjin.sexp.SEXP"><tt class="xref java java-ref docutils literal"><span class="pre">SEXP</span></tt></a> class
will return a String object with R&#8217;s name for the object type.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Don&#8217;t forget to import <tt class="docutils literal"><span class="pre">org.renjin.sexp.*</span></tt> to make Renjin&#8217;s type classes
available to your application.</p>
</div>
<p>In the example above we could have also cast R&#8217;s result to a <em>DoubleVector</em>
object:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">DoubleVector</span> <span class="n">res</span> <span class="o">=</span> <span class="o">(</span><span class="n">DoubleVector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;a &lt;- 2; b &lt;- 3; a*b&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>or you could cast it to a <em>Vector</em>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">Vector</span> <span class="n">res</span> <span class="o">=</span> <span class="o">(</span><span class="n">Vector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;a &lt;- 2; b &lt;- 3; a*b&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>You can&#8217;t cast R integer results to a <tt class="docutils literal"><span class="pre">DoubleVector</span></tt>: the following snippet
will throw a <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/ClassCastException.html" title="java.lang.ClassCastException"><tt class="xref java java-ref docutils literal"><span class="pre">ClassCastException</span></tt></a>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// use R&#39;s &#39;L&#39; suffix to define an integer:</span>
<span class="n">DoubleVector</span> <span class="n">res</span> <span class="o">=</span> <span class="o">(</span><span class="n">DoubleVector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;1L&quot;</span><span class="o">);</span>
</pre></div>
</div>
<div class="section" id="accessing-individual-elements-of-vectors">
<h3>2.3.1. Accessing individual elements of vectors<a class="headerlink" href="#accessing-individual-elements-of-vectors" title="Permalink to this headline">¶</a></h3>
<p>Now that we know how to pull R objects into our Java application we want to work
with these data types in Java. In this section we show how individual elements
of the Vector objects can be accessed in Java.</p>
<p>As you know, each vector type in R, and thus also in Renjin, has a length which
can be obtained with the <tt class="docutils literal"><span class="pre">length()</span></tt> method. Individual elements of a vector
can be obtained with the <tt class="docutils literal"><span class="pre">getElementAsXXX()</span></tt> methods where <tt class="docutils literal"><span class="pre">XXX</span></tt> is one of
<tt class="docutils literal"><span class="pre">Double</span></tt>, <tt class="docutils literal"><span class="pre">Int</span></tt>, <tt class="docutils literal"><span class="pre">String</span></tt>, <tt class="docutils literal"><span class="pre">Logical</span></tt>, and <tt class="docutils literal"><span class="pre">Complex</span></tt>. The following
snippet demonstrates this:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">Vector</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="n">Vector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;x &lt;- c(6, 7, 8, 9)&quot;</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;The vector &#39;x&#39; has length &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Element x[&quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;] is &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="na">getElementAsDouble</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This will write the following to the standard output:</p>
<div class="highlight-none"><div class="highlight"><pre>The vector &#39;x&#39; has length 4
Element x[1] is 6.0
Element x[2] is 7.0
Element x[3] is 8.0
Element x[4] is 9.0
</pre></div>
</div>
<p>As we have seen in the <a class="reference internal" href="#sec-lists"><em>Lists</em></a> section above, lists in R are also known
as <em>generic vectors</em>, but accessing the individual elements and their elements
requires a bit more care. If an element (i.e. a vector) of a list has length
equal to one, we can access this element directly using one of the
<tt class="docutils literal"><span class="pre">getElementAsXXX()</span></tt> methods. For example:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ListVector</span> <span class="n">x</span> <span class="o">=</span>
    <span class="o">(</span><span class="n">ListVector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;x &lt;- list(name = \&quot;Jane\&quot;, age = 23, scores = c(6, 7, 8, 9))&quot;</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;List &#39;x&#39; has length &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
<span class="c1">// directly access the first (and only) element of the vector &#39;x$name&#39;:</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;x$name is &#39;&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="na">getElementAsString</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>which will result in:</p>
<div class="highlight-none"><div class="highlight"><pre>List &#39;x&#39; has length 3
x$name is &#39;Jane&#39;
</pre></div>
</div>
<p>being printed to standard output. However, this approach will not work for the
third element of the list as this is a vector with length greater than one.
The preferred approach for lists is to get each element as a <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP" title="org.renjin.sexp.SEXP"><tt class="xref java java-ref docutils literal"><span class="pre">SEXP</span></tt></a>
object first and then to handle each of these accordingly. For example:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">DoubleVector</span> <span class="n">scores</span> <span class="o">=</span> <span class="o">(</span><span class="n">DoubleVector</span><span class="o">)</span><span class="n">x</span><span class="o">.</span><span class="na">getElementAsSEXP</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="dealing-with-matrices">
<span id="sec-dealing-with-matrices"></span><h3>2.3.2. Dealing with matrices<a class="headerlink" href="#dealing-with-matrices" title="Permalink to this headline">¶</a></h3>
<p>As described in the section <a class="reference internal" href="#sec-matrices-and-arrays"><em>Matrices and arrays</em></a> above, matrices are
simply vectors with the <tt class="docutils literal"><span class="pre">dim</span></tt> attribute set to an integer vector of length
two. In order to identify a matrix in Renjin, we need to therefore check for
the presence of this attribute and its value. Since any object in R can have
one or more attributes, the <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP" title="org.renjin.sexp.SEXP"><tt class="xref java java-ref docutils literal"><span class="pre">SEXP</span></tt></a> interface defines a number of
methods for dealing with attributes. In particular, <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP.hasAttributes()" title="org.renjin.sexp.SEXP.hasAttributes()"><tt class="xref java java-ref docutils literal"><span class="pre">hasAttributes</span></tt></a>
will return <tt class="docutils literal"><span class="pre">true</span></tt> if there are any attributes defined in an object and
<a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.SEXP.getAttributes()" title="org.renjin.sexp.SEXP.getAttributes()"><tt class="xref java java-ref docutils literal"><span class="pre">getAttributes</span></tt></a> will return these attributes as a
<a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.AttributeMap" title="org.renjin.sexp.AttributeMap"><tt class="xref java java-ref docutils literal"><span class="pre">AttributeMap</span></tt></a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">Vector</span> <span class="n">res</span> <span class="o">=</span> <span class="o">(</span><span class="n">Vector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;matrix(seq(9), nrow = 3)&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">hasAttributes</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">AttributeMap</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
    <span class="n">Vector</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="na">getDim</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">dim</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Result is a vector of length &quot;</span> <span class="o">+</span>
            <span class="n">res</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>

    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dim</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Result is a &quot;</span> <span class="o">+</span>
                <span class="n">dim</span><span class="o">.</span><span class="na">getElementAsInt</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span> <span class="o">+</span>
                <span class="n">dim</span><span class="o">.</span><span class="na">getElementAsInt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; matrix.&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Result is an array with &quot;</span> <span class="o">+</span>
                <span class="n">dim</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; dimensions.&quot;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Result is a 3x3 matrix.
</pre></div>
</div>
<p>For convenience, Renjin includes a wrapper class <tt class="docutils literal"><span class="pre">Matrix</span></tt> that provides
easier access to the number of rows and columns.</p>
<p id="index-8">Example:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// required import(s):</span>
<span class="kn">import</span> <span class="nn">org.renjin.primitives.matrix.*</span><span class="o">;</span>

<span class="n">Vector</span> <span class="n">res</span> <span class="o">=</span> <span class="o">(</span><span class="n">Vector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;matrix(seq(9), nrow = 3)&quot;</span><span class="o">);</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">Matrix</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Matrix</span><span class="o">(</span><span class="n">res</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Result is a &quot;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">getNumRows</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span>
        <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">getNumCols</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; matrix.&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Result is not a matrix: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Result is a 3x3 matrix.
</pre></div>
</div>
</div>
<div class="section" id="dealing-with-lists-and-data-frames">
<span id="sec-dealing-with-lists-and-data-frames"></span><h3>2.3.3. Dealing with lists and data frames<a class="headerlink" href="#dealing-with-lists-and-data-frames" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="renjin-java-api-specification.html#org.renjin.sexp.ListVector" title="org.renjin.sexp.ListVector"><tt class="xref java java-ref docutils literal"><span class="pre">ListVector</span></tt></a> class contains several convenience methods to access
a list&#8217;s components from Java. For example, we can the extract the components
from a fitted linear model using the name of the element that contains those
components. For example:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ListVector</span> <span class="n">model</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListVector</span><span class="o">)</span><span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;x &lt;- 1:10; y &lt;- x*3; lm(y ~ x)&quot;</span><span class="o">);</span>
<span class="n">Vector</span> <span class="n">coefficients</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getElementAsVector</span><span class="o">(</span><span class="s">&quot;coefficients&quot;</span><span class="o">);</span>
<span class="c1">// same result, but less convenient:</span>
<span class="c1">// int i = model.indexOfName(&quot;coefficients&quot;);</span>
<span class="c1">// Vector coefficients = (Vector)model.getElementAsSEXP(i);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;intercept = &quot;</span> <span class="o">+</span> <span class="n">coefficients</span><span class="o">.</span><span class="na">getElementAsDouble</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;slope = &quot;</span> <span class="o">+</span> <span class="n">coefficients</span><span class="o">.</span><span class="na">getElementAsDouble</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>intercept = -4.4938668397781774E-15
slope = 3.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="handling-errors-generated-by-the-r-code">
<span id="sec-dealing-with-errors-in-the-r-code"></span><h2>2.4. Handling errors generated by the R code<a class="headerlink" href="#handling-errors-generated-by-the-r-code" title="Permalink to this headline">¶</a></h2>
<p>Up to now we have been able to execute R code without any concern for possible
errors that may occur when the R code is evaluated. There are two common
exceptions that may be thrown by the R code:</p>
<ol class="arabic simple" id="index-9">
<li><a class="reference internal" href="renjin-java-api-specification.html#org.renjin.parser.ParseException" title="org.renjin.parser.ParseException"><tt class="xref java java-ref docutils literal"><span class="pre">ParseException</span></tt></a>: an exception thrown by Renjin&#8217;s R parser due to a syntax error and</li>
<li><a class="reference internal" href="renjin-java-api-specification.html#org.renjin.eval.EvalException" title="org.renjin.eval.EvalException"><tt class="xref java java-ref docutils literal"><span class="pre">EvalException</span></tt></a>: an exception thrown by Renjin when the R code generates an error condition, for example by the <tt class="docutils literal"><span class="pre">stop()</span></tt> function.</li>
</ol>
<p>Here is an example which catches an exception from Renjin&#8217;s parser:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// required import(s):</span>
<span class="kn">import</span> <span class="nn">org.renjin.parser.ParseException</span><span class="o">;</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;x &lt;- 1 +/ 1&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;R script parse error: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>R script parse error: Syntax error at line 1 char 0: syntax error, unexpected &#39;/&#39;
</pre></div>
</div>
<p>And here&#8217;s an example which catches an error condition thrown by the R interpreter:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// required import(s):</span>
<span class="kn">import</span> <span class="nn">org.renjin.eval.EvalException</span><span class="o">;</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;stop(\&quot;Hello world!\&quot;)&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">EvalException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// getCondition() returns the condition as an R list:</span>
    <span class="n">Vector</span> <span class="n">condition</span> <span class="o">=</span> <span class="o">(</span><span class="n">Vector</span><span class="o">)</span><span class="n">e</span><span class="o">.</span><span class="na">getCondition</span><span class="o">();</span>
    <span class="c1">// the first element of the string contains the actual error message:</span>
    <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="na">getElementAsString</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;The R script threw an error: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>The R script threw an error: Hello world!
</pre></div>
</div>
<p><a class="reference internal" href="renjin-java-api-specification.html#org.renjin.eval.EvalException.getCondition()" title="org.renjin.eval.EvalException.getCondition()"><tt class="xref java java-ref docutils literal"><span class="pre">EvalException.getCondition()</span></tt></a> is required to pull the condition
message from the R interpreter into Java.</p>
</div>
<div class="section" id="pushing-data-from-java-to-r">
<span id="sec-pushing-data-from-java-to-r"></span><h2>2.5. Pushing data from Java to R<a class="headerlink" href="#pushing-data-from-java-to-r" title="Permalink to this headline">¶</a></h2>
<p>Like many dynamic languages, R scripts are evaluated in the context of an
environment that looks a lot like a dictionary. You can define new variables in
this environment using the <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/javax/script/package-summary.html" title="javax.script.package-summary"><tt class="xref java java-ref docutils literal"><span class="pre">javax.script</span></tt></a> API. This is achieved using
the <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/javax/script/ScriptEngine.html#put(java.lang.String, java.lang.Object)" title="javax.script.ScriptEngine.put(java.lang.String, java.lang.Object)"><tt class="xref java java-ref docutils literal"><span class="pre">ScriptEngine.put()</span></tt></a> method.</p>
<p>Example:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">engine</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
<span class="n">engine</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;y&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]</span> <span class="o">{</span> <span class="mi">1</span><span class="n">d</span><span class="o">,</span> <span class="mi">2</span><span class="n">d</span><span class="o">,</span> <span class="mi">3</span><span class="n">d</span><span class="o">,</span> <span class="mi">4</span><span class="n">d</span> <span class="o">});</span>
<span class="n">engine</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;z&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">DoubleArrayVector</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">));</span>
<span class="n">engine</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;hashMap&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">HashMap</span><span class="o">());</span>
<span class="c1">// some R magic to print all objects and their class with a for-loop:</span>
<span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">&quot;for (obj in ls()) { &quot;</span> <span class="o">+</span>
    <span class="s">&quot;cmd &lt;- parse(text = paste(&#39;typeof(&#39;, obj, &#39;)&#39;, sep = &#39;&#39;));&quot;</span> <span class="o">+</span>
    <span class="s">&quot;cat(&#39;type of &#39;, obj, &#39; is &#39;, eval(cmd), &#39;\\n&#39;, sep = &#39;&#39;) }&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>type of hashMap is externalptr
type of x is integer
type of y is double
type of z is double
</pre></div>
</div>
<p>Renjin will implicitly convert primitives, arrays of primitives and
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html" title="java.lang.String"><tt class="xref java java-ref docutils literal"><span class="pre">String</span></tt></a> instances to R objects. Java objects will be wrapped as R
<tt class="docutils literal"><span class="pre">externalptr</span></tt> objects. The example also shows the use of the
<tt class="docutils literal"><span class="pre">DoubleArrayVector</span></tt> constructor to create a double vector in R. You see
that we managed to put a Java <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/util/HashMap.html" title="java.util.HashMap"><tt class="xref java java-ref docutils literal"><span class="pre">java.util.HashMap</span></tt></a> object into the
global environment of the R session: this is the topic of the chapter
<a class="reference internal" href="importing-java-classes-in-r-code.html#chap-importing-java-classes-into-r-code"><em>Importing Java classes into R code</em></a>.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="importing-java-classes-in-r-code.html" class="btn btn-neutral float-right" title="3. Importing Java classes into R code"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="1. Introduction"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, BeDataDriven.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0-RC7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>