

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Writing Renjin Extensions &mdash; Renjin 0.7.0-RC7 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Renjin 0.7.0-RC7 documentation" href="index.html"/>
        <link rel="next" title="5. Renjin Java API specification" href="renjin-java-api-specification.html"/>
        <link rel="prev" title="3. Importing Java classes into R code" href="importing-java-classes-in-r-code.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Renjin</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#about-renjin">1.1. About Renjin</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#prerequisites">1.2. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#setting-up-a-java-project-for-renjin">1.3. Setting up a Java project for Renjin</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#evaluating-r-language-code">1.4. Evaluating R language code</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#using-cran-packages-in-renjin">1.5. Using CRAN packages in Renjin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="moving-data-between-java-and-r-code.html">2. Moving data between Java and R code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="moving-data-between-java-and-r-code.html#a-java-developer-s-guide-to-r-objects">2.1. A Java developer&#8217;s guide to R objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="moving-data-between-java-and-r-code.html#overview-of-renjin-s-type-system">2.2. Overview of Renjin&#8217;s type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="moving-data-between-java-and-r-code.html#pulling-data-from-r-into-java">2.3. Pulling data from R into Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="moving-data-between-java-and-r-code.html#handling-errors-generated-by-the-r-code">2.4. Handling errors generated by the R code</a></li>
<li class="toctree-l2"><a class="reference internal" href="moving-data-between-java-and-r-code.html#pushing-data-from-java-to-r">2.5. Pushing data from Java to R</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="importing-java-classes-in-r-code.html">3. Importing Java classes into R code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="importing-java-classes-in-r-code.html#bean-classes">3.1. Bean classes</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">4. Writing Renjin Extensions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#package-directory-layout">4.1. Package directory layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="#renjin-maven-plugin">4.2. Renjin Maven plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-namespace-file">4.3. Package NAMESPACE file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-hamcrest-package-to-write-unit-tests">4.4. Using the <em>hamcrest</em> package to write unit tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="renjin-java-api-specification.html">5. Renjin Java API specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="renjin-java-api-specification.html#org-renjin-sexp">5.1. org.renjin.sexp</a></li>
<li class="toctree-l2"><a class="reference internal" href="renjin-java-api-specification.html#package-org.renjin.primitives.matrix">5.2. org.renjin.primitives.matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="renjin-java-api-specification.html#exceptions">5.3. Exceptions</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Renjin</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>4. Writing Renjin Extensions</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/writing-renjin-extensions.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="writing-renjin-extensions">
<h1>4. Writing Renjin Extensions<a class="headerlink" href="#writing-renjin-extensions" title="Permalink to this headline">¶</a></h1>
<p>This chapter can be considered as Renjin&#8217;s equivalent of the <a class="reference external" href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R
Extensions</a> manual for GNU R. Here we discuss how you create extensions, or
<em>packages</em> as they are referred to in R, for Renjin. Packages allow you to
group logically related functions and data together in a single archive which
can be reused and shared with others.</p>
<p>Renjin packages do not differ much from packages for GNU R. One notable
difference is that Renjin treats unit tests as first class citizens, i.e.
Renjin includes a package called <em>hamcrest</em> that provides functionality for
writing unit tests right out of the box. We encourage you to include as many
unit tests with your package as possible.</p>
<p>One feature currently missing for Renjin packages is the ability to document
your R code. You can use Javadoc to document your Java classes and methods.</p>
<div class="section" id="package-directory-layout">
<h2>4.1. Package directory layout<a class="headerlink" href="#package-directory-layout" title="Permalink to this headline">¶</a></h2>
<p>The files in a Renjin package must be organized in a directory structure that
adheres to the <a class="reference external" href="http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html">Maven standard directory layout</a>. A directory layout that will
cover most Renjin packages is as follows:</p>
<div class="highlight-none"><div class="highlight"><pre>projectdir/
    src/
        main/
            java/
                ...
            R/
            resources/
        test/
            java/
                ...
            R/
            resources/
    NAMESPACE
    pom.xml
</pre></div>
</div>
<p>The table <a class="reference internal" href="#tab-renjin-package-directory-layout"><em>Directories in a Renjin package</em></a> gives a short description
of the directories and files in this layout.</p>
<table border="1" class="docutils" id="tab-renjin-package-directory-layout">
<caption>Directories in a Renjin package</caption>
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Directory</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>src/main/java</td>
<td>Java source code (*.java files)</td>
</tr>
<tr class="row-odd"><td>src/main/R</td>
<td>R source code (*.R files)</td>
</tr>
<tr class="row-even"><td>src/main/resources</td>
<td>Files and directories to be copied to the root of the generated JAR file</td>
</tr>
<tr class="row-odd"><td>src/test/java</td>
<td>Unit tests written in Java using JUnit</td>
</tr>
<tr class="row-even"><td>src/test/R</td>
<td>Unit tests written in R using Renjin&#8217;s Hamcrest package</td>
</tr>
<tr class="row-odd"><td>src/test/resource</td>
<td>Files available to the unit tests (not copied into the generated JAR file)</td>
</tr>
<tr class="row-even"><td>NAMESPACE</td>
<td>Almost equivalent to R&#8217;s NAMESPACE file</td>
</tr>
<tr class="row-odd"><td>pom.xml</td>
<td>Maven&#8217;s Project Object Model file</td>
</tr>
</tbody>
</table>
<p>The functionality of the <em>DESCRIPTION</em> file used by GNU R packages is replaced
by a Maven <em>pom.xml</em> (POM) file. In this file you define the name of your
package and any dependencies, if applicable. The POM file is used by Renjin&#8217;s
Maven plugin to create the package. This is the subject of the next section.</p>
</div>
<div class="section" id="renjin-maven-plugin">
<h2>4.2. Renjin Maven plugin<a class="headerlink" href="#renjin-maven-plugin" title="Permalink to this headline">¶</a></h2>
<p>Whereas you would use the commands <tt class="docutils literal"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">check</span></tt>, <tt class="docutils literal"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">build</span></tt>, and <tt class="docutils literal"><span class="pre">R</span>
<span class="pre">CMD</span> <span class="pre">INSTALL</span></tt> to check, build (i.e. package), and install packages for GNU R,
packages for Renjin are tested, packaged, and installed using a Maven plugin.
The following XML file can be used as a <em>pom.xml</em> template for all Renjin
packages:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="s">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.acme<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>foobar<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

    <span class="c">&lt;!-- general information about your package --&gt;</span>
    <span class="nt">&lt;name&gt;</span>Package name or title<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;description&gt;</span>A short description of your package.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;url&gt;</span>http://www.url.to/your/package/website<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;licenses&gt;</span>
        <span class="c">&lt;!-- add one or more licenses under which the package is released --&gt;</span>
        <span class="nt">&lt;license&gt;</span>
            <span class="nt">&lt;name&gt;</span>Apache License version 2.0<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://www.apache.org/licenses/LICENSE-2.0.html<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/license&gt;</span>
    <span class="nt">&lt;/licenses&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- the script engine is convenient even if you do not use it explicitly --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.renjin<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>renjin-script-engine<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.7.0-RC7<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- the hamcrest package is only required if you use it for unit tests --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.renjin<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hamcrest<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.7.0-RC7<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>bedatadriven<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>bedatadriven public repo<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://nexus.bedatadriven.com/content/groups/public/<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.renjin<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>renjin-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>0.7.0-RC7<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>build<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>namespace-compile<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>compile<span class="nt">&lt;/phase&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>test<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>test<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>test<span class="nt">&lt;/phase&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<p>This POM file provides a lot of information:</p>
<ul class="simple">
<li>fully qualified name of the package, namely <em>com.acme.foobar</em>;</li>
<li>package version, namely <em>1.0-SNAPSHOT</em>;</li>
<li>package dependencies and their versions, namely the Renjin Script Engine and
the <em>hamcrest</em> package (see the next section);</li>
<li>BeDataDriven&#8217;s public repository to look for the dependencies if it can&#8217;t
find them locally or in Maven Central;</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Package names is one area where Renjin takes a different approach to GNU R
and adheres to the Java standard of using fully qualified names. The
package in the example above must be loaded using its fully qualified name,
that is with <tt class="docutils literal"><span class="pre">library(com.acme.foobar)</span></tt> or <tt class="docutils literal"><span class="pre">require(com.acme.foobar)</span></tt>.
The group ID (<em>com.acme</em> in this example) is traditionally a domain over
which only you have control. The artifact ID should have only <a class="reference external" href="http://maven.apache.org/guides/mini/guide-naming-conventions.html">lower case
letters and no strange symbols</a>. The term <em>artifact</em> is used by Maven to
refer to the result of a build which, in the context of this chapter, is
always a package.</p>
</div>
<p>Now you can use Maven to test, package, and install your package using the
following commands:</p>
<dl class="docutils">
<dt>mvn test</dt>
<dd>run the package tests (both the Java and R code tests)</dd>
<dt>mvn package</dt>
<dd>create a JAR file of the package (named <em>foobar-1.0-SNAPSHOT.jar</em> in the
example above) in the <tt class="docutils literal"><span class="pre">target</span></tt> folder of the package&#8217;s root directory</dd>
<dt>mvn install</dt>
<dd>install the artifact (i.e. package) into the local repository</dd>
<dt>mvn deploy</dt>
<dd>upload the artifact to a remote repository (requires additional
configuration)</dd>
<dt>mvn clean</dt>
<dd>clean the project&#8217;s working directory after a build (can also be combined
with one of the previous commands, for example: <tt class="docutils literal"><span class="pre">mvn</span> <span class="pre">clean</span> <span class="pre">install</span></tt>)</dd>
</dl>
</div>
<div class="section" id="package-namespace-file">
<h2>4.3. Package NAMESPACE file<a class="headerlink" href="#package-namespace-file" title="Permalink to this headline">¶</a></h2>
<p>Since R version 2.14, packages are required to have a <tt class="docutils literal"><span class="pre">NAMESPACE</span></tt> file and the
same holds for Renjin. Because of dynamic searching for objects in R, the use of
a <tt class="docutils literal"><span class="pre">NAMESPACE</span></tt> file is good practice anyway. The <tt class="docutils literal"><span class="pre">NAMESPACE</span></tt> file is used to
explicitly define which functions should be <em>imported</em> into the package&#8217;s
namespace and which functions the package exposes (i.e. <em>exports</em>) to other
packages. Using this file, the package developer controls how his or her package
finds functions.</p>
<p>Usage of the <tt class="docutils literal"><span class="pre">NAMESPACE</span></tt> in Renjin is almost exactly the same as in GNU R
save for two differences:</p>
<ol class="arabic simple">
<li>the directives related to S4 classes are not yet supported by Renjin and</li>
<li>Renjin accepts the directive <tt class="docutils literal"><span class="pre">importClass()</span></tt> for importing Java classes
into the package namespace.</li>
</ol>
<p>Here is an overview of the namespace directives that Renjin supports:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">export(f)</span></tt> or <tt class="docutils literal"><span class="pre">export(f,</span> <span class="pre">g)</span></tt></dt>
<dd>Export an object <tt class="docutils literal"><span class="pre">f</span></tt> (singular form) or multiple objects <tt class="docutils literal"><span class="pre">f</span></tt> and <tt class="docutils literal"><span class="pre">g</span></tt>
(plural form). You can add as many objects to this directive as you like.</dd>
<dt><tt class="docutils literal"><span class="pre">exportPattern(&quot;^[^\\.]&quot;)</span></tt></dt>
<dd>Export all objects whose name does not start with a period (&#8216;.&#8217;).
Although any regular expression can be used in this directive, this is by
far the most common one. It is considered to be good practice not to use
this directive and to explicitly export objects using the <tt class="docutils literal"><span class="pre">export()</span></tt>
directive.</dd>
<dt><tt class="docutils literal"><span class="pre">import(foo)</span></tt> or <tt class="docutils literal"><span class="pre">import(foo,</span> <span class="pre">bar)</span></tt></dt>
<dd>Import all exported objects from the package named <tt class="docutils literal"><span class="pre">foo</span></tt> (and <tt class="docutils literal"><span class="pre">bar</span></tt>
in the plural form). Like the <tt class="docutils literal"><span class="pre">export()</span></tt> directive, you can add as many
objects as you like to this directive.</dd>
<dt><tt class="docutils literal"><span class="pre">importFrom(foo,</span> <span class="pre">f)</span></tt> or <tt class="docutils literal"><span class="pre">importFrom(foo,</span> <span class="pre">f,</span> <span class="pre">g)</span></tt></dt>
<dd>Import only object <tt class="docutils literal"><span class="pre">f</span></tt> (and <tt class="docutils literal"><span class="pre">g</span></tt> in the plural form) from the package
named <tt class="docutils literal"><span class="pre">foo</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">S3method(print,</span> <span class="pre">foo)</span></tt></dt>
<dd>Register a print (S3) method for the <tt class="docutils literal"><span class="pre">foo</span></tt> class. This ensures that other
packages understand that you provide a function <tt class="docutils literal"><span class="pre">print.foo()</span></tt> that is a
print method for class <tt class="docutils literal"><span class="pre">foo</span></tt>. The <tt class="docutils literal"><span class="pre">print.foo()</span></tt> does not need to be
exported.</dd>
<dt><tt class="docutils literal"><span class="pre">importClass(com.acme.myclass)</span></tt></dt>
<dd>A namespace directive which is unique to Renjin and which allows Java
classes to be imported into the package namespace. This directive is
actually a function which does the same as Renjin&#8217;s <tt class="docutils literal"><span class="pre">import()</span></tt> function
that was introduced in the chapter <a class="reference internal" href="importing-java-classes-in-r-code.html"><em>Importing Java classes into R code</em></a>.</dd>
</dl>
<p>The R functions in your package have access to all R functions defined within
your package (also those that are not explicitely exported) as well as the Java
classes imported into the package names using the <tt class="docutils literal"><span class="pre">importClass</span></tt> directive.</p>
</div>
<div class="section" id="using-the-hamcrest-package-to-write-unit-tests">
<h2>4.4. Using the <em>hamcrest</em> package to write unit tests<a class="headerlink" href="#using-the-hamcrest-package-to-write-unit-tests" title="Permalink to this headline">¶</a></h2>
<p>Renjin includes a built-in package called <em>hamcrest</em> for writing unit tests
using the R language. The package and its test functions are inspired by the
Hamcrest framework. From <a class="reference external" href="https://code.google.com/p/hamcrest/wiki/Tutorial">hamcrest.org</a>: <em>Hamcrest is a framework for writing
matcher objects allowing &#8216;match&#8217; rules to be defined declaratively.</em> The
<a class="reference external" href="http://en.wikipedia.org/wiki/Hamcrest">Wikipedia article on Hamcrest</a> gives a good and short explanation of
the rationale behind the framework.</p>
<p>If you are familiar with the &#8216;expectation&#8217; functions used in the <a class="reference external" href="http://cran.r-project.org/web/packages/testthat/index.html">testthat</a>
package for GNU R, then you will find many similarities with the assertion and
matcher functions in Renjin&#8217;s <em>hamcrest</em> package.</p>
<p>A test is a single R function with no arguments and a name that starts with
<tt class="docutils literal"><span class="pre">test.</span></tt>. Each test function can contain one or more assertions and the test
fails if at least one of the assertions throws an error. For example, using the
package defined in the previous section:</p>
<div class="highlight-r"><div class="highlight"><pre>library<span class="p">(</span>hamcrest<span class="p">)</span>
library<span class="p">(</span>com.acme.foobar<span class="p">)</span>

test.df <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
    df <span class="o">&lt;-</span> data.frame<span class="p">(</span>x <span class="o">=</span> seq<span class="p">(</span><span class="m">10</span><span class="p">),</span> y <span class="o">=</span> runif<span class="p">(</span><span class="m">10</span><span class="p">))</span>

    assertThat<span class="p">(</span>df<span class="p">,</span> instanceOf<span class="p">(</span><span class="s">&quot;data.frame&quot;</span><span class="p">))</span>
    assertThat<span class="p">(</span>dim<span class="p">(</span>df<span class="p">),</span> equalTo<span class="p">(</span>c<span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">2</span><span class="p">)))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Test functions are stored in R script files (i.e. files with extension <tt class="docutils literal"><span class="pre">.R</span></tt>
or <tt class="docutils literal"><span class="pre">.S</span></tt>) in the <tt class="docutils literal"><span class="pre">src/test/R</span></tt> folder of your package. Each file should start
with the statement <tt class="docutils literal"><span class="pre">library(hamcrest)</span></tt> in order to attach the <em>hamcrest</em>
package to the search path as well as a <tt class="docutils literal"><span class="pre">library()</span></tt> statement to load your
own package.  You can put test functions in different files to group them
according to your liking.</p>
<p>The central function is the <tt class="docutils literal"><span class="pre">assertThat(actual,</span> <span class="pre">expected)</span></tt> function which takes
two arguments: <tt class="docutils literal"><span class="pre">actual</span></tt> is the object about which you want to make an assertion
and <tt class="docutils literal"><span class="pre">expected</span></tt> is the matcher function that defines the rule of the assertion.
In the example above, we make two assertions about the data frame <tt class="docutils literal"><span class="pre">df</span></tt>, namely
that it should have class <em>data.frame</em> and that its dimension is equal to the
vector <tt class="docutils literal"><span class="pre">c(10,</span> <span class="pre">2)</span></tt> (i.e. ten rows and two columns). The following sections
describe the available matcher functions in more detail.</p>
<div class="section" id="testing-for-near-equality">
<h3>4.4.1. Testing for (near) equality<a class="headerlink" href="#testing-for-near-equality" title="Permalink to this headline">¶</a></h3>
<p>Use <tt class="docutils literal"><span class="pre">equalTo()</span></tt> to test if <tt class="docutils literal"><span class="pre">actual</span></tt> is equal to <tt class="docutils literal"><span class="pre">expected</span></tt>:</p>
<div class="highlight-r"><div class="highlight"><pre>assertThat<span class="p">(</span>actual<span class="p">,</span> equalTo<span class="p">(</span>expected<span class="p">))</span>
</pre></div>
</div>
<p>Two objects are considered to be equal if they have the same length and if
<tt class="docutils literal"><span class="pre">actual</span> <span class="pre">==</span> <span class="pre">expected</span></tt> is <tt class="docutils literal"><span class="pre">TRUE</span></tt>.</p>
<p>Use <tt class="docutils literal"><span class="pre">identicalTo()</span></tt> to test if <tt class="docutils literal"><span class="pre">actual</span></tt> is identical to <tt class="docutils literal"><span class="pre">expected</span></tt>:</p>
<div class="highlight-r"><div class="highlight"><pre>assertThat<span class="p">(</span>actual<span class="p">,</span> identicalTo<span class="p">(</span>expected<span class="p">))</span>
</pre></div>
</div>
<p>Two objects are considered to be identical if <tt class="docutils literal"><span class="pre">identical(actual,</span> <span class="pre">expected)</span></tt> is
<tt class="docutils literal"><span class="pre">TRUE</span></tt>. This test is much stricter than <tt class="docutils literal"><span class="pre">equalTo()</span></tt> as it also checks that the
type of the objects and their attributes are the same.</p>
<p>Use <tt class="docutils literal"><span class="pre">closeTo()</span></tt> to test for near equality (i.e. with some margin of error as
defined by the <tt class="docutils literal"><span class="pre">delta</span></tt> argument):</p>
<div class="highlight-r"><div class="highlight"><pre>assertThat<span class="p">(</span>actual<span class="p">,</span> closeTo<span class="p">(</span>expected<span class="p">,</span> delta<span class="p">))</span>
</pre></div>
</div>
<p>This assertion only accepts numeric vectors as arguments and <tt class="docutils literal"><span class="pre">delta</span></tt> must
have length 1. The assertion also throws an error if <tt class="docutils literal"><span class="pre">actual</span></tt> and
<tt class="docutils literal"><span class="pre">expected</span></tt> do not have the same length. If their lengths are greater than 1,
the largest (absolute) difference between their elements may not exceed
<tt class="docutils literal"><span class="pre">delta</span></tt>.</p>
</div>
<div class="section" id="testing-for-true-or-false">
<h3>4.4.2. Testing for TRUE or FALSE<a class="headerlink" href="#testing-for-true-or-false" title="Permalink to this headline">¶</a></h3>
<p>Use <tt class="docutils literal"><span class="pre">isTrue()</span></tt> and <tt class="docutils literal"><span class="pre">isFalse()</span></tt> to check that an object is identical to <tt class="docutils literal"><span class="pre">TRUE</span></tt>
or <tt class="docutils literal"><span class="pre">FALSE</span></tt> respectively:</p>
<div class="highlight-r"><div class="highlight"><pre>assertThat<span class="p">(</span>actual<span class="p">,</span> isTrue<span class="p">())</span>
assertTrue<span class="p">(</span>actual<span class="p">)</span> <span class="c1"># same, but shorter</span>
assertThat<span class="p">(</span>actual<span class="p">,</span> identicalTo<span class="p">(</span><span class="kc">TRUE</span><span class="p">))</span> <span class="c1"># same, but longer</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-for-class-inheritance">
<h3>4.4.3. Testing for class inheritance<a class="headerlink" href="#testing-for-class-inheritance" title="Permalink to this headline">¶</a></h3>
<p>Use <tt class="docutils literal"><span class="pre">instanceOf()</span></tt> to check if an object <em>inherits</em> from a class:</p>
<div class="highlight-r"><div class="highlight"><pre>assertThat<span class="p">(</span>actual<span class="p">,</span> instanceOf<span class="p">(</span>expected<span class="p">))</span>
</pre></div>
</div>
<p>An object is assumed to inherit from a class if <tt class="docutils literal"><span class="pre">inherits(actual,</span> <span class="pre">expected)</span></tt> is
<tt class="docutils literal"><span class="pre">TRUE</span></tt>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Renjin&#8217;s <em>hamcrest</em> package also exists as a GNU R package with the same
name available at <a class="reference external" href="https://github.com/bedatadriven/hamcrest">https://github.com/bedatadriven/hamcrest</a>. If you are
writing a package for both Renjin and GNU R, you can use the <em>hamcrest</em>
package to check the compatibility of your code by running the test files
in both Renjin and GNU R.</p>
</div>
</div>
<div class="section" id="understanding-test-results">
<h3>4.4.4. Understanding test results<a class="headerlink" href="#understanding-test-results" title="Permalink to this headline">¶</a></h3>
<p>When you run <tt class="docutils literal"><span class="pre">mvn</span> <span class="pre">test</span></tt> within the directory that holds the POM file (i.e.
the root directory of your package), Maven will execute both the Java and R
unit tests and output various bits of information including the test results.
The results for the Java tests are summarized in a section marked with:</p>
<div class="highlight-none"><div class="highlight"><pre>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
</pre></div>
</div>
<p>and which will summarize the test results like:</p>
<div class="highlight-none"><div class="highlight"><pre>Results :

Tests run: 5, Failures: 1, Errors: 0, Skipped: 0
</pre></div>
</div>
<p>The results of the R tests are summarized in a section marked with:</p>
<div class="highlight-none"><div class="highlight"><pre>-------------------------------------------------------
 R E N J I N   T E S T S
-------------------------------------------------------
</pre></div>
</div>
<p>The R tests are summarized per R source file which will look similar to the
following example:</p>
<div class="highlight-none"><div class="highlight"><pre>Running tests in /home/foobar/mypkg/src/test/R
Running function_test.R
No default packages specified
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.898
</pre></div>
</div>
<p>Note that the number of tests run is equal to the number of <tt class="docutils literal"><span class="pre">test.*</span></tt>
functions in the R source file + 1 as running the test file is also counted as
a test. The next section explains how to use the functionality of Renjin&#8217;s
<em>hamcrest</em> package to write unit tests.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="renjin-java-api-specification.html" class="btn btn-neutral float-right" title="5. Renjin Java API specification"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="importing-java-classes-in-r-code.html" class="btn btn-neutral" title="3. Importing Java classes into R code"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, BeDataDriven.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0-RC7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>